
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Pathary Documentation (fork of Movary)">
      
      
      
        <link rel="canonical" href="https://docs.pathary.tv/oauth-monitoring-setup/">
      
      
      
      
        
      
      
      <link rel="icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>OAuth Token Monitoring Setup Guide - Pathary Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#oauth-token-monitoring-setup-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Pathary Documentation" class="md-header__button md-logo" aria-label="Pathary Documentation" data-md-component="logo">
      
  <img src="../images/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pathary Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OAuth Token Monitoring Setup Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/benjaminmue/pathary/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pathary Documentation" class="md-nav__button md-logo" aria-label="Pathary Documentation" data-md-component="logo">
      
  <img src="../images/favicon.png" alt="logo">

    </a>
    Pathary Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/benjaminmue/pathary/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker (recommended)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../initial-user-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Initial User Setup
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/movies-and-tmdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Movies and TMDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/ratings-and-comments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ratings and Comments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/tmdb-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TMDB Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/imdb-rating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IMDb Rating
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/locations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Locations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/plex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plex
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/jellyfin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jellyfin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/emby/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Emby
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/kodi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kodi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/letterboxd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Letterboxd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/trakt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trakt TV
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/netflix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Netflix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/radarr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Radarr
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/routing-and-controllers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Routing and Controllers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/frontend-and-ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Frontend and UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/authentication-and-sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication and Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/two-factor-authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Two-Factor Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/password-policy-and-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Password Policy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oauth-email-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OAuth Email Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operations/logging-and-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging and Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/file-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Directory Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/database-migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Migrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../issue-labels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Issue Labels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Features
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lazy-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lazy Monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-interval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Interval
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alert-schedule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alert Schedule
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-run-database-migration" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Run Database Migration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-verify-installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Verify Installation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Behavior
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#health-evaluation-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Health Evaluation Logic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alert-level-determination" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alert Level Determination
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notification-suppression" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notification Suppression
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin-experience" class="md-nav__link">
    <span class="md-ellipsis">
      
        Admin Experience
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Admin Experience">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#email-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        Email Notifications
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin-banner" class="md-nav__link">
    <span class="md-ellipsis">
      
        Admin Banner
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin-events-log" class="md-nav__link">
    <span class="md-ellipsis">
      
        Admin Events Log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-monitoring-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        No Monitoring Events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-alerts-received" class="md-nav__link">
    <span class="md-ellipsis">
      
        No Alerts Received
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#banner-not-showing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Banner Not Showing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-running-too-frequently" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Running Too Frequently
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#false-alerts" class="md-nav__link">
    <span class="md-ellipsis">
      
        False Alerts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whats-logged" class="md-nav__link">
    <span class="md-ellipsis">
      
        What's Logged
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whats-never-logged" class="md-nav__link">
    <span class="md-ellipsis">
      
        What's NEVER Logged
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-retention" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Retention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjusting-monitoring-interval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adjusting Monitoring Interval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjusting-alert-thresholds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adjusting Alert Thresholds
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-health-check-for-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Health Check (For Testing)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disabling-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disabling Features
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maintenance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-monitoring-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check Monitoring Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-immediate-check" class="md-nav__link">
    <span class="md-ellipsis">
      
        Force Immediate Check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleanup-old-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cleanup Old Events
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Support
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/benjaminmue/pathary/edit/main/docs/oauth-monitoring-setup.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/benjaminmue/pathary/raw/main/docs/oauth-monitoring-setup.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="oauth-token-monitoring-setup-guide">OAuth Token Monitoring Setup Guide</h1>
<p>This guide explains the automated OAuth token monitoring system for Email OAuth connections in Pathary.</p>
<h2 id="overview">Overview</h2>
<p>The OAuth monitoring system automatically checks the health of your Email OAuth connection (Gmail or Microsoft 365) and alerts administrators when action is needed. This prevents email sending failures due to expired or revoked OAuth tokens.</p>
<p><strong>No configuration required</strong> - monitoring runs automatically when users visit the site.</p>
<h2 id="features">Features</h2>
<ul>
<li><strong>Automatic Health Checks</strong>: Runs on page loads without requiring cron jobs or scheduled tasks</li>
<li><strong>Smart Throttling</strong>: Checks run at most every 6 hours to avoid overhead</li>
<li><strong>Multi-Tier Alerts</strong>: Warnings at 45, 30, and 15 days before recommended refresh</li>
<li><strong>Admin Notifications</strong>: Email alerts to all administrators</li>
<li><strong>Admin Popup Banner</strong>: Visual alerts when admins login (dismissible for 3 hours)</li>
<li><strong>Event Logging</strong>: All monitoring events logged to Admin → Events</li>
<li><strong>System Health Dashboard</strong>: OAuth status visible in System Health (future feature)</li>
</ul>
<h2 id="how-it-works">How It Works</h2>
<h3 id="lazy-monitoring">Lazy Monitoring</h3>
<p>Pathary uses a "lazy monitoring" approach where OAuth health checks are triggered automatically when any user visits the site:</p>
<ol>
<li><strong>On Page Load</strong>: Every web request checks if monitoring should run</li>
<li><strong>Time-Based Throttling</strong>: Monitoring only runs if at least 6 hours have passed since the last check</li>
<li><strong>Database Locking</strong>: Concurrent requests are prevented via database locks</li>
<li><strong>Non-Blocking</strong>: Monitoring runs in the background and doesn't slow down page loads</li>
</ol>
<p>This approach means:
- ✅ No cron jobs to configure
- ✅ No external schedulers needed
- ✅ Works in any hosting environment (Unraid, VPS, Docker, etc.)
- ✅ Monitoring happens automatically as long as someone uses the site
- ⚠️ Requires occasional site visits (at least once every 6 hours for timely alerts)</p>
<h3 id="monitoring-interval">Monitoring Interval</h3>
<p>The system runs health checks <strong>at most every 6 hours</strong>. This interval balances:
- Timely detection of OAuth issues
- Minimal overhead on page loads
- Reduced API calls to OAuth providers</p>
<p>If you need more frequent checks, you can visit any page in Pathary to trigger a check (if 6+ hours have elapsed).</p>
<h2 id="alert-schedule">Alert Schedule</h2>
<table>
<thead>
<tr>
<th>Threshold</th>
<th>Alert Level</th>
<th>Notification Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td>45 days before refresh needed</td>
<td>Warning</td>
<td>Once, then weekly</td>
</tr>
<tr>
<td>30 days before refresh needed</td>
<td>Warning</td>
<td>Once, then every 3 days</td>
</tr>
<tr>
<td>15 days before refresh needed</td>
<td>Critical</td>
<td>Once, then daily</td>
</tr>
<tr>
<td>Token refresh failing</td>
<td>Critical</td>
<td>Daily until resolved</td>
</tr>
<tr>
<td>Re-authorization required</td>
<td>Expired</td>
<td>Immediate, then daily</td>
</tr>
</tbody>
</table>
<h2 id="installation">Installation</h2>
<h3 id="1-run-database-migration">1. Run Database Migration</h3>
<p>The OAuth monitoring system requires database schema changes. Run the migration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># In Docker (recommended)</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>app<span class="w"> </span>php<span class="w"> </span>vendor/bin/phinx<span class="w"> </span>migrate<span class="w"> </span>-c<span class="w"> </span>./settings/phinx.php

<span class="c1"># Locally (if running without Docker)</span>
php<span class="w"> </span>vendor/bin/phinx<span class="w"> </span>migrate<span class="w"> </span>-c<span class="w"> </span>./settings/phinx.php
</code></pre></div>
<p>This adds:
- Monitoring fields to <code>oauth_email_config</code> table
- <code>oauth_admin_banner_ack</code> table for tracking banner acknowledgements</p>
<h3 id="2-verify-installation">2. Verify Installation</h3>
<p><strong>That's it!</strong> No additional configuration needed. The monitoring system is now active.</p>
<p>To verify it's working:</p>
<ol>
<li>
<p><strong>Check the logs</strong> after visiting a page:
   <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>app<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;oauth monitoring&quot;</span>

<span class="c1"># You should see entries like:</span>
<span class="c1"># [INFO] Triggering lazy OAuth monitoring</span>
<span class="c1"># [INFO] Lazy OAuth monitoring completed</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Visit Admin → Events</strong>:</p>
</li>
<li>Login as admin</li>
<li>Go to Admin → Events</li>
<li>Filter by event type containing "oauth"</li>
<li>
<p>You should see monitoring events logged after 6+ hours of site activity</p>
</li>
<li>
<p><strong>Check last run time</strong> in the database (optional):
   <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>db<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>movary<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;USE movary; SELECT * FROM server_setting WHERE \`key\` = &#39;oauth_monitoring_last_run_at&#39;;&quot;</span>
</code></pre></div></p>
</li>
</ol>
<h2 id="monitoring-behavior">Monitoring Behavior</h2>
<h3 id="health-evaluation-logic">Health Evaluation Logic</h3>
<p>The system evaluates OAuth health based on:</p>
<ol>
<li><strong>Token Refresh Success</strong>: Can the system successfully refresh the access token?</li>
<li><strong>Days Since Last Refresh</strong>: How long since the last successful refresh?</li>
<li><strong>Error Patterns</strong>: What errors are occurring (if any)?</li>
<li><strong>Re-auth Required</strong>: Does the error indicate re-authorization is needed?</li>
</ol>
<h3 id="alert-level-determination">Alert Level Determination</h3>
<ul>
<li><strong>OK</strong>: Recent successful refresh, no failures</li>
<li><strong>Warning</strong>: Approaching recommended refresh interval (45/30/15 days)</li>
<li><strong>Critical</strong>: Token refresh failing or very close to recommended refresh</li>
<li><strong>Expired</strong>: Re-authorization required, token revoked, or refresh failing for 7+ days</li>
</ul>
<h3 id="notification-suppression">Notification Suppression</h3>
<p>Notifications are sent according to the schedule above and are suppressed if:
- Already notified within the scheduled interval
- Alert level has not escalated
- Admin has acknowledged the banner within the last 3 hours (banner only)</p>
<h2 id="admin-experience">Admin Experience</h2>
<h3 id="email-notifications">Email Notifications</h3>
<p>Admins receive email alerts when thresholds are crossed. Emails include:</p>
<ul>
<li>Alert level (WARNING/CRITICAL/URGENT)</li>
<li>Provider name (Gmail/Microsoft 365)</li>
<li>Status message with details</li>
<li>Days to action (if applicable)</li>
<li>Last error details (if any)</li>
<li>Direct link to Email Settings page</li>
</ul>
<p><strong>Important</strong>: Emails are sent using fallback SMTP password authentication if OAuth is failing, ensuring you always receive alerts.</p>
<h3 id="admin-banner">Admin Banner</h3>
<p>When admins visit any page in Pathary, they may see a modal banner if:</p>
<ul>
<li>OAuth connection requires attention (warn/critical/expired)</li>
<li>Banner was not acknowledged in the last 3 hours</li>
<li>Alert level has not been resolved</li>
</ul>
<p>The banner can be:
- <strong>Acknowledged</strong>: Dismissed for 3 hours
- <strong>Bypassed</strong>: Click "Open Email Settings" to address immediately</p>
<p>If alert level escalates (e.g., warn → critical), banner shows immediately even if recently acknowledged.</p>
<h3 id="admin-events-log">Admin Events Log</h3>
<p>All monitoring activities are logged to Admin → Events:</p>
<ul>
<li><code>oauth_token_warn_45/30/15</code> - Warning notifications sent</li>
<li><code>oauth_token_warn_daily</code> - Daily critical alert sent</li>
<li><code>oauth_token_expired</code> - Token expiry detected</li>
<li><code>oauth_token_refresh_failed</code> - Token refresh failed</li>
<li><code>oauth_token_refresh_recovered</code> - Token refresh recovered after failure</li>
<li><code>oauth_banner_acknowledged</code> - Admin acknowledged banner</li>
</ul>
<p>Events include metadata:
- Provider (gmail/microsoft)
- Alert level
- Error code (if applicable)
- Re-auth required status</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="no-monitoring-events">No Monitoring Events</h3>
<p><strong>Problem</strong>: No OAuth monitoring events appearing in Admin → Events</p>
<p><strong>Solutions</strong>:
1. Ensure database migration was run: <code>docker compose exec app php vendor/bin/phinx migrate -c ./settings/phinx.php</code>
2. Verify OAuth is configured: Admin → Email Settings → OAuth tab
3. Check if anyone has visited the site in the last 6 hours (monitoring needs page loads)
4. Check application logs: <code>docker compose logs app | grep -i oauth</code>
5. Visit a page and wait a moment, then check logs again</p>
<h3 id="no-alerts-received">No Alerts Received</h3>
<p><strong>Problem</strong>: OAuth may be failing but no alerts sent</p>
<p><strong>Solutions</strong>:
1. Verify monitoring is running: Check Admin → Events for recent <code>oauth_token_</code> events
2. Check if OAuth is actually configured: Admin → Email Settings → OAuth tab
3. Verify admin users have valid email addresses
4. Check application logs: <code>docker compose logs app | grep -i oauth</code>
5. Verify email sending works: Admin → Email Settings → Test Email</p>
<h3 id="banner-not-showing">Banner Not Showing</h3>
<p><strong>Problem</strong>: Admin banner not appearing</p>
<p><strong>Solutions</strong>:
1. Verify you're logged in as admin
2. Check OAuth alert level by visiting Admin → Email Settings → OAuth tab
3. Check browser console for JavaScript errors (F12 → Console)
4. Clear browser cache and reload page
5. Verify banner was not recently acknowledged: Check <code>oauth_admin_banner_ack</code> table</p>
<h3 id="monitoring-running-too-frequently">Monitoring Running Too Frequently</h3>
<p><strong>Problem</strong>: Monitoring appears to run on every page load</p>
<p><strong>Solutions</strong>:
1. Check database for last run time:
   <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>db<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>movary<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;USE movary; SELECT * FROM server_setting WHERE \`key\` = &#39;oauth_monitoring_last_run_at&#39;;&quot;</span>
</code></pre></div>
2. Verify 6-hour interval is being enforced in logs
3. Check for database lock issues:
   <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>db<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>movary<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;USE movary; SELECT * FROM server_setting WHERE \`key\` = &#39;oauth_monitoring_lock&#39;;&quot;</span>
</code></pre></div>
   - If a lock is stuck, delete it: <code>DELETE FROM server_setting WHERE \</code>key` = 'oauth_monitoring_lock';`</p>
<h3 id="false-alerts">False Alerts</h3>
<p><strong>Problem</strong>: Receiving alerts but OAuth is working fine</p>
<p><strong>Solutions</strong>:
1. Check if your OAuth provider has temporary issues
2. Review error codes in Admin → Events to identify pattern
3. If using Microsoft 365, verify SMTP AUTH is enabled at tenant level
4. Try reconnecting OAuth: Admin → Email Settings → OAuth → Disconnect → Connect</p>
<h2 id="security-considerations">Security Considerations</h2>
<h3 id="whats-logged">What's Logged</h3>
<p>The monitoring system logs:
- Event types and timestamps
- Provider names (gmail/microsoft)
- Error codes (sanitized)
- Alert levels
- IP addresses of admin actions</p>
<h3 id="whats-never-logged">What's NEVER Logged</h3>
<ul>
<li>Access tokens</li>
<li>Refresh tokens</li>
<li>Client secrets</li>
<li>Full error messages containing tokens</li>
<li>Admin passwords</li>
<li>Email content</li>
</ul>
<h3 id="data-retention">Data Retention</h3>
<ul>
<li>Monitoring events follow the same retention as other security audit logs</li>
<li>Banner acknowledgements are kept until replaced (one per admin user)</li>
<li>Recommendation: Implement periodic cleanup of old audit logs (90 days)</li>
</ul>
<h2 id="advanced-configuration">Advanced Configuration</h2>
<h3 id="adjusting-monitoring-interval">Adjusting Monitoring Interval</h3>
<p>Edit <code>src/Service/Email/OAuthLazyMonitoringService.php</code>:</p>
<div class="highlight"><pre><span></span><code><span class="x">// Run monitoring at most every X hours</span>
<span class="x">private const MIN_INTERVAL_SECONDS = 21600; // 6 hours (default)</span>

<span class="x">// Change to 3 hours:</span>
<span class="x">private const MIN_INTERVAL_SECONDS = 10800;</span>

<span class="x">// Change to 12 hours:</span>
<span class="x">private const MIN_INTERVAL_SECONDS = 43200;</span>
</code></pre></div>
<p><strong>Warning</strong>: More frequent checks increase database queries and OAuth provider API calls.</p>
<h3 id="adjusting-alert-thresholds">Adjusting Alert Thresholds</h3>
<p>Edit <code>src/Service/Email/OAuthMonitoringService.php</code>:</p>
<div class="highlight"><pre><span></span><code><span class="x">// Health thresholds (days)</span>
<span class="x">private const THRESHOLD_45_DAYS = 45;  // First warning</span>
<span class="x">private const THRESHOLD_30_DAYS = 30;  // Second warning</span>
<span class="x">private const THRESHOLD_15_DAYS = 15;  // Critical warning</span>
<span class="x">private const DAILY_ALERT_START = 14;  // Start daily alerts</span>
<span class="x">private const MAX_DAYS_WITHOUT_REFRESH = 60; // Token age limit</span>
</code></pre></div>
<p><strong>Warning</strong>: Changing these values requires understanding OAuth refresh token lifecycle for your provider.</p>
<h3 id="manual-health-check-for-testing">Manual Health Check (For Testing)</h3>
<p>You can force an immediate monitoring run by resetting the last run time:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>db<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>movary<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;USE movary; DELETE FROM server_setting WHERE \`key\` = &#39;oauth_monitoring_last_run_at&#39;;&quot;</span>
</code></pre></div>
<p>Then visit any page in Pathary to trigger monitoring immediately.</p>
<h3 id="disabling-features">Disabling Features</h3>
<p><strong>Disable email notifications</strong>: Remove admin email addresses (banner will still work)</p>
<p><strong>Disable banner</strong>: Remove the banner include from <code>templates/layouts/app_base.twig</code></p>
<p><strong>Disable monitoring completely</strong>: Don't run the database migration</p>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Visit the site regularly</strong>: Monitoring requires page loads, so ensure at least one admin checks the site daily</li>
<li><strong>Test email delivery</strong>: Before relying on email alerts, send a test email from Admin → Email Settings</li>
<li><strong>Document your OAuth setup</strong>: Keep records of client ID, tenant ID, and expiry dates</li>
<li><strong>Monitor the monitoring</strong>: Check Admin → Events periodically to ensure monitoring runs</li>
<li><strong>Act promptly on alerts</strong>: Don't wait until expiry to reconnect</li>
<li><strong>Keep refresh tokens fresh</strong>: Reconnect OAuth yearly even if not prompted</li>
</ol>
<h2 id="maintenance">Maintenance</h2>
<h3 id="check-monitoring-status">Check Monitoring Status</h3>
<p>View recent monitoring activity:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check logs</span>
docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>app<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;oauth monitoring&quot;</span>

<span class="c1"># Check last run time</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>db<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>movary<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;USE movary; SELECT * FROM server_setting WHERE \`key\` = &#39;oauth_monitoring_last_run_at&#39;;&quot;</span>

<span class="c1"># Check for stuck locks</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>db<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>movary<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;USE movary; SELECT * FROM server_setting WHERE \`key\` = &#39;oauth_monitoring_lock&#39;;&quot;</span>
</code></pre></div>
<h3 id="force-immediate-check">Force Immediate Check</h3>
<p>Reset last run time and visit any page:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>db<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>movary<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;USE movary; DELETE FROM server_setting WHERE \`key\` = &#39;oauth_monitoring_last_run_at&#39;;&quot;</span>
</code></pre></div>
<h3 id="cleanup-old-events">Cleanup Old Events</h3>
<p>Manually clean up old OAuth monitoring events:</p>
<div class="highlight"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_security_audit_log</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">event_type</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;oauth_%&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="n">NOW</span><span class="p">(),</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">DAY</span><span class="p">);</span>
</code></pre></div>
<p>Or programmatically (future feature):
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>app<span class="w"> </span>php<span class="w"> </span>/app/bin/console.php<span class="w"> </span>audit:cleanup<span class="w"> </span>--days<span class="o">=</span><span class="m">90</span>
</code></pre></div></p>
<h2 id="support">Support</h2>
<p>For issues or questions:</p>
<ol>
<li>Check application logs: <code>docker compose logs app</code></li>
<li>Review Admin → Events for error patterns</li>
<li>Test OAuth connection manually: Admin → Email Settings → OAuth → Test Connection</li>
<li>Create an issue: https://github.com/benjaminmue/pathary/issues</li>
</ol>
<h2 id="future-enhancements">Future Enhancements</h2>
<p>Planned features:
- System Health dashboard tile for OAuth status
- Configurable thresholds via admin UI
- Webhook notifications
- Slack/Discord integration
- Multi-tenant OAuth support
- Manual "Check Now" button in admin UI</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.action.edit", "content.action.view"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>