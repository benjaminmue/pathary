
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Pathary Documentation (fork of Movary)">
      
      
      
        <link rel="canonical" href="https://docs.pathary.tv/security/two-factor-authentication/">
      
      
        <link rel="prev" href="../authentication-and-sessions/">
      
      
        <link rel="next" href="../password-policy-and-security/">
      
      
        
      
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Two-Factor Authentication - Pathary Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#two-factor-authentication-2fa" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Pathary Documentation" class="md-header__button md-logo" aria-label="Pathary Documentation" data-md-component="logo">
      
  <img src="../../images/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pathary Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Two-Factor Authentication
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/benjaminmue/pathary/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Pathary Documentation" class="md-nav__button md-logo" aria-label="Pathary Documentation" data-md-component="logo">
      
  <img src="../../images/favicon.png" alt="logo">

    </a>
    Pathary Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/benjaminmue/pathary/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker (recommended)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../initial-user-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Initial User Setup
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/movies-and-tmdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Movies and TMDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/ratings-and-comments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ratings and Comments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/tmdb-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TMDB Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/imdb-rating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IMDb Rating
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/locations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Locations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/plex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plex
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/jellyfin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jellyfin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/emby/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Emby
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/kodi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kodi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/letterboxd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Letterboxd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/trakt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trakt TV
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/netflix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Netflix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/radarr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Radarr
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/routing-and-controllers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Routing and Controllers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/frontend-and-ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Frontend and UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../authentication-and-sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication and Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Two-Factor Authentication
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Two-Factor Authentication
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-2fa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enabling 2FA
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enabling 2FA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-navigate-to-security-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Navigate to Security Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-generate-qr-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Generate QR Code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-verify-totp-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Verify TOTP Code
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recovery-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recovery Codes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recovery Codes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial Generation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regenerating-recovery-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regenerating Recovery Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-recovery-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Recovery Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-code-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recovery Code Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trusted-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trusted Devices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trusted Devices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trusting-a-device" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trusting a Device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-limits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Device Limits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managing-trusted-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Managing Trusted Devices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trusted-device-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trusted Device Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-audit-log" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Audit Log
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Audit Log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logged-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logged Events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-audit-log" class="md-nav__link">
    <span class="md-ellipsis">
      
        Viewing Audit Log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-flow-with-2fa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Login Flow with 2FA
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login Flow with 2FA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#without-trusted-device" class="md-nav__link">
    <span class="md-ellipsis">
      
        Without Trusted Device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-trusted-device" class="md-nav__link">
    <span class="md-ellipsis">
      
        With Trusted Device
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disabling-2fa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disabling 2FA
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Files
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-routes" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Routes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Pages
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../password-policy-and-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Password Policy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oauth-email-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OAuth Email Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/logging-and-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging and Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/file-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Directory Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/database-migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Migrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../issue-labels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Issue Labels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-2fa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enabling 2FA
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enabling 2FA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-navigate-to-security-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Navigate to Security Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-generate-qr-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Generate QR Code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-verify-totp-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Verify TOTP Code
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recovery-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recovery Codes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recovery Codes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial Generation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regenerating-recovery-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regenerating Recovery Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-recovery-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Recovery Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-code-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recovery Code Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trusted-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trusted Devices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trusted Devices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trusting-a-device" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trusting a Device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-limits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Device Limits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managing-trusted-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Managing Trusted Devices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trusted-device-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trusted Device Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-audit-log" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Audit Log
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Audit Log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logged-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logged Events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-audit-log" class="md-nav__link">
    <span class="md-ellipsis">
      
        Viewing Audit Log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-flow-with-2fa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Login Flow with 2FA
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login Flow with 2FA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#without-trusted-device" class="md-nav__link">
    <span class="md-ellipsis">
      
        Without Trusted Device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-trusted-device" class="md-nav__link">
    <span class="md-ellipsis">
      
        With Trusted Device
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disabling-2fa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disabling 2FA
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Files
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-routes" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Routes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Pages
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/benjaminmue/pathary/edit/main/docs/security/two-factor-authentication.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/benjaminmue/pathary/raw/main/docs/security/two-factor-authentication.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="two-factor-authentication-2fa">Two-Factor Authentication (2FA)</h1>
<p>Pathary provides comprehensive Two-Factor Authentication using Time-based One-Time Passwords (TOTP), along with recovery codes and trusted device management.</p>
<h2 id="overview">Overview</h2>
<p>Pathary's 2FA system includes:
- <strong>TOTP Authentication</strong> - Compatible with authenticator apps (Google Authenticator, Authy, 1Password, etc.)
- <strong>Recovery Codes</strong> - 10 single-use backup codes for account recovery
- <strong>Trusted Devices</strong> - Option to trust devices for 30 days
- <strong>Security Audit Log</strong> - Track all security events</p>
<h2 id="enabling-2fa">Enabling 2FA</h2>
<h3 id="step-1-navigate-to-security-settings">Step 1: Navigate to Security Settings</h3>
<div class="highlight"><pre><span></span><code>Profile → Security Tab → Two-Factor Authentication section
</code></pre></div>
<h3 id="step-2-generate-qr-code">Step 2: Generate QR Code</h3>
<ol>
<li>Click "Enable 2FA"</li>
<li>A QR code will be displayed</li>
<li>Scan the QR code with your authenticator app</li>
</ol>
<p><strong>File</strong>: <code>src/HttpController/Web/ProfileSecurityController.php:enableTotp()</code></p>
<p>The system generates a secret key using:
<div class="highlight"><pre><span></span><code><span class="x">$totpSecret = $this-&gt;twoFactorAuthenticationApi-&gt;generateTotpSecret();</span>
<span class="x">$totpUri = $this-&gt;twoFactorAuthenticationApi-&gt;buildTotpUri($user-&gt;getName(), $totpSecret);</span>
</code></pre></div></p>
<h3 id="step-3-verify-totp-code">Step 3: Verify TOTP Code</h3>
<ol>
<li>Enter the 6-digit code from your authenticator app</li>
<li>Click "Verify and Enable"</li>
</ol>
<p><strong>File</strong>: <code>src/HttpController/Web/ProfileSecurityController.php:verifyAndSaveTotp()</code></p>
<p>Upon successful verification:
- TOTP is enabled for your account
- 10 recovery codes are automatically generated
- You'll see a confirmation modal with recovery codes</p>
<h2 id="recovery-codes">Recovery Codes</h2>
<p>Recovery codes are single-use backup codes that allow you to log in if you lose access to your authenticator app.</p>
<h3 id="initial-generation">Initial Generation</h3>
<p>When you enable 2FA, 10 recovery codes are automatically generated and displayed in a modal with the following features:
- <strong>Confirmation Required</strong>: You must check "I have saved these codes" AND enter one of the codes to confirm
- <strong>Security</strong>: Codes are hashed using bcrypt before storage
- <strong>Progressive UI</strong>: Shows step-by-step progress through confirmation</p>
<p><strong>File</strong>: <code>src/Domain/User/Service/RecoveryCodeService.php:generateRecoveryCodes()</code></p>
<div class="highlight"><pre><span></span><code><span class="x">public function generateRecoveryCodes(int $userId) : array</span>
<span class="x">{</span>
<span class="x">    // Generate 10 random codes</span>
<span class="x">    for ($i = 0; $i &lt; 10; $i++) {</span>
<span class="x">        $code = $this-&gt;generateRandomCode();</span>
<span class="x">        $codes[] = $code;</span>

<span class="x">        // Hash and store</span>
<span class="x">        $this-&gt;repository-&gt;create($userId, password_hash($code, PASSWORD_DEFAULT));</span>
<span class="x">    }</span>

<span class="x">    return $codes;</span>
<span class="x">}</span>
</code></pre></div>
<h3 id="regenerating-recovery-codes">Regenerating Recovery Codes</h3>
<p>You can regenerate all recovery codes at any time:</p>
<div class="highlight"><pre><span></span><code>Profile → Security Tab → Recovery Codes section → Regenerate Codes
</code></pre></div>
<p><strong>Warning</strong>: Regenerating codes will invalidate all previous codes.</p>
<p><strong>Route</strong>: <code>POST /profile/security/recovery-codes/regenerate</code></p>
<h3 id="using-recovery-codes">Using Recovery Codes</h3>
<p>When logging in with 2FA enabled:
1. Enter your email and password
2. Click "Use Recovery Code" instead of entering authenticator code
3. Enter one of your recovery codes
4. The code will be consumed and cannot be used again</p>
<p><strong>File</strong>: <code>src/Domain/User/Service/Authentication.php:login()</code></p>
<div class="highlight"><pre><span></span><code><span class="x">// Check if recovery code is provided</span>
<span class="x">if ($recoveryCode !== null) {</span>
<span class="x">    if ($this-&gt;recoveryCodeService-&gt;verifyAndConsumeCode($user-&gt;getId(), $recoveryCode) === false) {</span>
<span class="x">        throw InvalidRecoveryCode::create();</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<h3 id="recovery-code-storage">Recovery Code Storage</h3>
<p>Recovery codes are stored in the <code>recovery_codes</code> table:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>INT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>INT</td>
<td>User reference</td>
</tr>
<tr>
<td><code>code_hash</code></td>
<td>VARCHAR(255)</td>
<td>Bcrypt hash of code</td>
</tr>
<tr>
<td><code>used</code></td>
<td>BOOLEAN</td>
<td>Whether code has been used</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>Creation time</td>
</tr>
<tr>
<td><code>used_at</code></td>
<td>DATETIME</td>
<td>When code was used (nullable)</td>
</tr>
</tbody>
</table>
<p><strong>Migration</strong>: <code>db/migrations/*/20251217120000_CreateRecoveryCodesTable.php</code></p>
<h2 id="trusted-devices">Trusted Devices</h2>
<p>Trusted devices allow you to bypass 2FA for 30 days on specific devices you mark as trusted.</p>
<h3 id="trusting-a-device">Trusting a Device</h3>
<p>When logging in with 2FA:
1. Enter your authenticator code or recovery code
2. Check "Trust this device for 30 days"
3. Complete login</p>
<p><strong>File</strong>: <code>src/Domain/User/Service/TrustedDeviceService.php:createTrustedDevice()</code></p>
<p>A secure cookie is set:
<div class="highlight"><pre><span></span><code><span class="x">setcookie(</span>
<span class="x">    &#39;trusted_device&#39;,</span>
<span class="x">    $deviceToken,</span>
<span class="x">    [</span>
<span class="x">        &#39;expires&#39; =&gt; time() + (30 * 24 * 60 * 60),  // 30 days</span>
<span class="x">        &#39;path&#39; =&gt; &#39;/&#39;,</span>
<span class="x">        &#39;secure&#39; =&gt; true,</span>
<span class="x">        &#39;httponly&#39; =&gt; true,</span>
<span class="x">        &#39;samesite&#39; =&gt; &#39;Lax&#39;,</span>
<span class="x">    ],</span>
<span class="x">);</span>
</code></pre></div></p>
<h3 id="device-limits">Device Limits</h3>
<ul>
<li>Maximum of <strong>10 trusted devices</strong> per user</li>
<li>Oldest devices are automatically removed when limit is reached</li>
<li>Device tokens are 256-bit random strings, hashed with <code>PASSWORD_DEFAULT</code></li>
</ul>
<h3 id="managing-trusted-devices">Managing Trusted Devices</h3>
<p>View and manage trusted devices in your security settings:</p>
<div class="highlight"><pre><span></span><code>Profile → Security Tab → Trusted Devices section
</code></pre></div>
<p>You can see:
- Device name (parsed from user agent)
- Last used date
- Creation date</p>
<p><strong>Actions</strong>:
- <strong>Revoke Single Device</strong>: <code>POST /profile/security/trusted-devices/{deviceId}/revoke</code>
- <strong>Revoke All Devices</strong>: <code>POST /profile/security/trusted-devices/revoke-all</code></p>
<p><strong>File</strong>: <code>src/Util/DeviceNameParser.php</code> parses user agents to friendly names:
- Chrome on Windows → "Chrome (Windows)"
- Safari on iPhone → "Safari (iPhone)"
- Firefox on macOS → "Firefox (macOS)"</p>
<h3 id="trusted-device-storage">Trusted Device Storage</h3>
<p>Trusted devices are stored in the <code>trusted_devices</code> table:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>INT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>INT</td>
<td>User reference</td>
</tr>
<tr>
<td><code>device_token</code></td>
<td>VARCHAR(64)</td>
<td>Random token</td>
</tr>
<tr>
<td><code>device_token_hash</code></td>
<td>VARCHAR(255)</td>
<td>Password hash of token</td>
</tr>
<tr>
<td><code>device_name</code></td>
<td>VARCHAR(256)</td>
<td>Parsed device name</td>
</tr>
<tr>
<td><code>user_agent</code></td>
<td>TEXT</td>
<td>Full user agent string</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>When device was trusted</td>
</tr>
<tr>
<td><code>last_used_at</code></td>
<td>DATETIME</td>
<td>Last login from device</td>
</tr>
<tr>
<td><code>expires_at</code></td>
<td>DATETIME</td>
<td>When trust expires (30 days)</td>
</tr>
</tbody>
</table>
<p><strong>Migration</strong>: <code>db/migrations/*/20251217120001_CreateTrustedDevicesTable.php</code></p>
<h2 id="security-audit-log">Security Audit Log</h2>
<p>All security events are logged in the <code>security_audit_log</code> table for monitoring and forensics.</p>
<h3 id="logged-events">Logged Events</h3>
<table>
<thead>
<tr>
<th>Event Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>2fa_enabled</code></td>
<td>User enabled 2FA</td>
</tr>
<tr>
<td><code>2fa_disabled</code></td>
<td>User disabled 2FA</td>
</tr>
<tr>
<td><code>2fa_verified</code></td>
<td>Successful 2FA login</td>
</tr>
<tr>
<td><code>2fa_failed</code></td>
<td>Failed 2FA attempt</td>
</tr>
<tr>
<td><code>recovery_code_used</code></td>
<td>Recovery code used for login</td>
</tr>
<tr>
<td><code>recovery_codes_regenerated</code></td>
<td>New recovery codes generated</td>
</tr>
<tr>
<td><code>trusted_device_added</code></td>
<td>Device marked as trusted</td>
</tr>
<tr>
<td><code>trusted_device_revoked</code></td>
<td>Trusted device revoked</td>
</tr>
<tr>
<td><code>password_changed</code></td>
<td>Password changed</td>
</tr>
</tbody>
</table>
<h3 id="viewing-audit-log">Viewing Audit Log</h3>
<div class="highlight"><pre><span></span><code>Profile → Security Tab → Security Activity section
</code></pre></div>
<p><strong>Route</strong>: <code>GET /profile/security/events</code></p>
<p>Events are displayed with:
- Event type
- Timestamp
- Device information
- IP address (if available)</p>
<p><strong>File</strong>: <code>src/Domain/User/Service/SecurityAuditService.php</code></p>
<div class="highlight"><pre><span></span><code><span class="x">public function logEvent(</span>
<span class="x">    int $userId,</span>
<span class="x">    string $eventType,</span>
<span class="x">    ?string $deviceName = null,</span>
<span class="x">    ?string $ipAddress = null,</span>
<span class="x">    ?array $metadata = null</span>
<span class="x">) : void {</span>
<span class="x">    $this-&gt;repository-&gt;create(</span>
<span class="x">        $userId,</span>
<span class="x">        $eventType,</span>
<span class="x">        $deviceName,</span>
<span class="x">        $ipAddress,</span>
<span class="x">        $metadata ? json_encode($metadata) : null</span>
<span class="x">    );</span>
<span class="x">}</span>
</code></pre></div>
<h2 id="login-flow-with-2fa">Login Flow with 2FA</h2>
<h3 id="without-trusted-device">Without Trusted Device</h3>
<div class="highlight"><pre><span></span><code>1. Enter email + password
2. Submit login form
3. If 2FA enabled:
   a. Show 2FA code input
   b. Enter authenticator code OR recovery code
   c. Optionally check &quot;Trust this device&quot;
4. Complete login
</code></pre></div>
<h3 id="with-trusted-device">With Trusted Device</h3>
<div class="highlight"><pre><span></span><code>1. Enter email + password
2. Submit login form
3. System checks for valid trusted_device cookie
4. If valid and not expired:
   → Skip 2FA verification
5. Complete login immediately
</code></pre></div>
<p><strong>File</strong>: <code>src/Domain/User/Service/Authentication.php:findUserAndVerifyAuthentication()</code></p>
<div class="highlight"><pre><span></span><code><span class="x">// Check if device is trusted</span>
<span class="x">if ($this-&gt;trustedDeviceService-&gt;isDeviceTrusted($user-&gt;getId(), $deviceToken)) {</span>
<span class="x">    // Skip 2FA verification</span>
<span class="x">    return $user;</span>
<span class="x">}</span>

<span class="x">// Otherwise, require 2FA</span>
<span class="x">if ($totpUri !== null) {</span>
<span class="x">    if ($userTotpCode === null &amp;&amp; $recoveryCode === null) {</span>
<span class="x">        throw MissingTotpCode::create();</span>
<span class="x">    }</span>
<span class="x">    // Verify TOTP or recovery code...</span>
<span class="x">}</span>
</code></pre></div>
<h2 id="disabling-2fa">Disabling 2FA</h2>
<p>To disable 2FA:</p>
<div class="highlight"><pre><span></span><code>Profile → Security Tab → Two-Factor Authentication section → Disable 2FA
</code></pre></div>
<p><strong>Route</strong>: <code>POST /profile/security/totp/disable</code></p>
<p><strong>Effects</strong>:
- TOTP secret is removed
- All recovery codes are deleted
- All trusted devices are revoked
- Audit log entry is created</p>
<p><strong>File</strong>: <code>src/HttpController/Web/ProfileSecurityController.php:disableTotp()</code></p>
<h2 id="template-files">Template Files</h2>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>templates/page/login.html.twig</code></td>
<td>Login form with 2FA code input and mode switching</td>
</tr>
<tr>
<td><code>templates/public/profile-security.twig</code></td>
<td>Security settings page with 2FA management</td>
</tr>
<tr>
<td><code>public/js/login.js</code></td>
<td>Login form JavaScript with 2FA handling</td>
</tr>
<tr>
<td><code>public/js/profile-security.js</code></td>
<td>Security settings JavaScript with recovery code confirmation</td>
</tr>
</tbody>
</table>
<h2 id="api-routes">API Routes</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Route</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/profile/security/totp/enable</code></td>
<td>Generate TOTP QR code</td>
</tr>
<tr>
<td>POST</td>
<td><code>/profile/security/totp/verify</code></td>
<td>Verify and save TOTP</td>
</tr>
<tr>
<td>POST</td>
<td><code>/profile/security/totp/disable</code></td>
<td>Disable 2FA</td>
</tr>
<tr>
<td>POST</td>
<td><code>/profile/security/recovery-codes/regenerate</code></td>
<td>Regenerate recovery codes</td>
</tr>
<tr>
<td>POST</td>
<td><code>/profile/security/trusted-devices/{deviceId}/revoke</code></td>
<td>Revoke single device</td>
</tr>
<tr>
<td>POST</td>
<td><code>/profile/security/trusted-devices/revoke-all</code></td>
<td>Revoke all devices</td>
</tr>
<tr>
<td>GET</td>
<td><code>/profile/security/events</code></td>
<td>Get security audit log</td>
</tr>
</tbody>
</table>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Enable 2FA</strong> for all accounts, especially admin accounts</li>
<li><strong>Save recovery codes</strong> in a secure location (password manager, encrypted file)</li>
<li><strong>Trust devices carefully</strong> - only trust your personal devices</li>
<li><strong>Review audit log</strong> periodically for suspicious activity</li>
<li><strong>Regenerate recovery codes</strong> if you suspect they've been compromised</li>
<li><strong>Revoke trusted devices</strong> when selling/disposing of hardware</li>
</ol>
<h2 id="related-pages">Related Pages</h2>
<ul>
<li><a href="Authentication-and-Sessions">Authentication and Sessions</a> - Login and session management</li>
<li><a href="Password-Policy-and-Security">Password Policy and Security</a> - Password requirements</li>
<li><a href="Database">Database</a> - Security-related table schemas</li>
</ul>
<hr />
<p><a href="Home">← Back to Wiki Home</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>