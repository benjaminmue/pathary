{% extends 'base.html.twig' %}

{% set showFooter = false %}

{% block title %}
    Create Password
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ applicationUrl }}/css/login.css">
{% endblock %}

{% block scripts %}
    <script src="{{ applicationUrl }}/js/login-bg.js"></script>
{% endblock %}

{% block body %}
    <div class="login-container">
        <!-- Centered Logo with Circle Background -->
        <div class="login-logo-wrapper">
            <div class="login-logo-circle">
                <div class="login-logo-container">
                    <img src="{{ applicationUrl }}/images/pathary-logo.svg"
                         alt="{{ applicationName ?? 'Pathary' }} logo"
                         class="login-logo">
                </div>
            </div>
        </div>

        <!-- Password Setup Card -->
        <div class="login-card">
            <h1 class="text-center mb-4">Create Your Password</h1>

            <p class="text-center text-muted mb-4">
                Welcome, <strong>{{ userName }}</strong>!<br>
                Please create a password for your account.
            </p>

            <form method="POST" action="{{ applicationUrl }}/setup-password">
                <input type="hidden" name="token" value="{{ token }}">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">

                <div class="form-floating mb-3">
                    <input type="password"
                           class="form-control {% if errorPasswordTooShort or errorPasswordPolicyViolation %}is-invalid{% endif %}"
                           id="password"
                           name="password"
                           placeholder="Password"
                           minlength="10"
                           required>
                    <label for="password">Password</label>
                    {% if errorPasswordTooShort %}
                        <div class="invalid-feedback">
                            Password must be at least 10 characters long.
                        </div>
                    {% endif %}
                    {% if errorPasswordPolicyViolation %}
                        <div class="invalid-feedback">
                            {{ errorPasswordPolicyViolation }}
                        </div>
                    {% endif %}
                </div>

                <div class="form-floating mb-3">
                    <input type="password"
                           class="form-control {% if errorPasswordNotEqual %}is-invalid{% endif %}"
                           id="repeatPassword"
                           name="repeatPassword"
                           placeholder="Confirm Password"
                           minlength="10"
                           required>
                    <label for="repeatPassword">Confirm Password</label>
                    {% if errorPasswordNotEqual %}
                        <div class="invalid-feedback">
                            Passwords do not match.
                        </div>
                    {% endif %}
                </div>

                {% if missingFormData %}
                    <div class="alert alert-danger" role="alert">
                        Please fill in all fields.
                    </div>
                {% endif %}

                {% if rateLimitExceeded %}
                    <div class="alert alert-warning" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Too many attempts.</strong> Please wait 15 minutes and try again.
                    </div>
                {% endif %}

                <div class="alert alert-info small mb-3">
                    <strong>Password Requirements:</strong>
                    <ul class="mb-0 ps-3">
                        <li>Minimum 10 characters</li>
                        <li>At least 1 uppercase letter</li>
                        <li>At least 1 lowercase letter</li>
                        <li>At least 1 number</li>
                        <li>At least 1 special character</li>
                    </ul>
                </div>

                <button class="w-100 btn btn-lg btn-primary mb-3" type="submit">
                    Create Password
                </button>
            </form>

            <div class="text-center">
                <a href="{{ applicationUrl }}/login">Back to login</a>
            </div>
        </div>
    </div>
{% endblock %}
