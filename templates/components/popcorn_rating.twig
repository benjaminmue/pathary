{#
    Popcorn Rating Component (Emoji Version)

    Parameters:
    - valueInt: integer 0-7 or null (current rating value)
    - mode: "display" or "input" (default: "display")
    - name: string (form input name, required for input mode)
    - readonly: bool (default: false)
#}

{% set currentValue = valueInt ?? 0 %}
{% set isInput = mode|default('display') == 'input' %}
{% set isReadonly = readonly|default(false) %}

<div class="popcorn-rating {% if isInput and not isReadonly %}popcorn-rating--input{% endif %}"
     {% if isInput %}data-popcorn-rating{% endif %}
     role="{% if isInput and not isReadonly %}group{% else %}img{% endif %}"
     aria-label="Rating: {{ currentValue }} out of 7">

    {% if isInput %}
        <input type="hidden"
               name="{{ name }}"
               value="{{ currentValue }}"
               class="popcorn-rating__value">
    {% endif %}

    {% for i in 1..7 %}
        {% set isOn = i <= currentValue %}

        {% if isInput and not isReadonly %}
            <button type="button"
                    class="popcorn-rating__item {{ isOn ? 'popcorn-on' : 'popcorn-off' }}"
                    data-value="{{ i }}"
                    aria-label="Rate {{ i }} out of 7"
                    aria-pressed="{{ isOn ? 'true' : 'false' }}">ğŸ¿</button>
        {% else %}
            <span class="popcorn-rating__item {{ isOn ? 'popcorn-on' : 'popcorn-off' }}"
                  aria-hidden="true">ğŸ¿</span>
        {% endif %}
    {% endfor %}
</div>
