{#
    Popcorn Rating Component

    Parameters:
    - valueInt: integer 0-7 or null (current rating value)
    - mode: "display" or "input" (default: "display")
    - name: string (form input name, required for input mode)
    - readonly: bool (default: false)
#}

{% set currentValue = valueInt ?? 0 %}
{% set isInput = mode|default('display') == 'input' %}
{% set isReadonly = readonly|default(false) %}

{# Inline SVG for popcorn icon #}
{% macro popcorn_svg() %}
<svg viewBox="0 0 24 24" width="32" height="32" class="popcorn-icon" aria-hidden="true">
    <path d="M7 22l1-9H4c-.8 0-1.3-.9-.8-1.5l3-4C5.5 5.5 5 4.3 5 3c0-1.7 1.3-3 3-3 .8 0 1.5.3 2 .8C10.5.3 11.2 0 12 0s1.5.3 2 .8c.5-.5 1.2-.8 2-.8 1.7 0 3 1.3 3 3 0 1.3-.5 2.5-1.2 3.5l3 4c.5.6 0 1.5-.8 1.5h-4l1 9H7z"/>
    <circle cx="9" cy="4" r="1.5"/>
    <circle cx="15" cy="4" r="1.5"/>
    <circle cx="12" cy="6" r="1.5"/>
</svg>
{% endmacro %}

<div class="popcorn-rating {% if isInput and not isReadonly %}popcorn-rating--input{% endif %}"
     {% if isInput %}data-popcorn-rating{% endif %}
     role="{% if isInput and not isReadonly %}group{% else %}img{% endif %}"
     aria-label="Rating: {{ currentValue }} out of 7">

    {% if isInput %}
        <input type="hidden"
               name="{{ name }}"
               value="{{ currentValue }}"
               class="popcorn-rating__value">
    {% endif %}

    {% for i in 1..7 %}
        {% set isOn = i <= currentValue %}

        {% if isInput and not isReadonly %}
            <button type="button"
                    class="popcorn-rating__item {{ isOn ? 'popcorn-on' : 'popcorn-off' }}"
                    data-value="{{ i }}"
                    aria-label="Set rating to {{ i }} out of 7"
                    aria-pressed="{{ isOn ? 'true' : 'false' }}">
                {{ _self.popcorn_svg() }}
            </button>
        {% else %}
            <span class="popcorn-rating__item {{ isOn ? 'popcorn-on' : 'popcorn-off' }}">
                {{ _self.popcorn_svg() }}
            </span>
        {% endif %}
    {% endfor %}
</div>
